

<%= render 'layouts/admin_header' %> 

<ul class="nav nav-tabs nav-justified " style="background-color:rgba(66,75,87,0.2); text-decoration: none;">
	<li role="presentation" style="border: solid 1px #999999;"><%= link_to "TOPページ", (top_path), :style => "text-decoration: none;"  %></li>
	<li role="presentation" style="border: solid 1px #999999;"><%= link_to "シフト作成ページ", (time_tables_path), :style => "text-decoration: none;" %></li>
	<li role="presentation" style="border: solid 1px #999999;"><%= link_to "従業員一覧", (employees_path), :style => "text-decoration: none;" %></li>
</ul>

<div>
	<div class="shift">
		<table>
			<tr>
				<th></th>


	            <th>
	               <% sss = TimeTable.find_by(date: "2018-11-1") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{1}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-2") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{2}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-3") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day" style="color:red;"><%= "#{3}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
	               <% sss = TimeTable.find_by(date: "2018-11-4") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day" style="color:red;"><%= "#{4}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-5") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{5}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-6") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{6}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
	               <% sss = TimeTable.find_by(date: "2018-11-7") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{7}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>

					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-8") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{8}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-9") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{9}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				 <th>
	               <% sss = TimeTable.find_by(date: "2018-11-10") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day" style="color:red;"><%= "#{10}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-11") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day" style="color:red;"><%= "#{11}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-12") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{12}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
	               <% sss = TimeTable.find_by(date: "2018-11-13") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{13}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-14") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{14}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>
				<th>
					<% sss = TimeTable.find_by(date: "2018-11-15") %>
					<%= link_to (manning_path(sss)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="day"><%= "#{15}日" %> (<%= %w(日 月 火 水 木 金 土)[sss.date.wday] %>)</div>
					<% end %>
				</th>

	            <td><div class="day"></div></td>
				<td><div class="day"></div></td>

			</tr>

			<tr>
				<td><div class="boxaa"></div></td>
				   <% 15.times do |i| %>
				<td><div class="boxa"></div></td>
				　　<% end %>
				<td><div class="boxa"></div></td>
				<td><div class="boxa"></div></td>
			</tr>


	        <% @employees.each do |employee| %>

			<tr>
				<td>
					<%= link_to (edit_employee_path(employee.id)), :style => "text-decoration: none;", :class => "link" do %>
					<div class="boxe"><%= employee.name %></div>
					<% end %>
				</td>


			    <% date = DateTable.find_by(employee_id: employee.id, date: "2018-11-01") %>
			        <% unless date == nil %>
			    <% time = TimeTable.where(date_table_id: date.id) %>

			        <% @working_time = 0 %> <!-- 労働時間 -->
			        <% @over_time = 0 %>  <!-- 残業時間 -->

			     <% time.each do |t| %>
	<!-- 　154行目までは労働時間を出すための計算 -->
		            <% @all_working_time = t.first_timex - t.first_time %>
		            <% @lt = t.last_timex -  t.last_time %>

	            <% if @lt == 30 %>
	            <%  @all_working_time += 0.5 %>

	            <% elsif @lt == -30 %>
	            <% @all_working_time -= 0.5 %>

	            <% end %>

	            <% @working_time += @all_working_time %>
	<!-- 143行目から労働時間を出すための計算 -->
    <!-- ここから残業時間を出すための計算 -->
			    <%  @all_over_time = @all_working_time - 8 %>

			    <% if @all_over_time >= 0 %>
			    <% @over_time += @all_over_time %>
			    <% end %>


	            <% if t.first_time != 100 %>
		            <td>
		                <%= link_to (edit_time_table_path(t)), :style => "text-decoration: none;", :class => "link_time" do %>
			        	    <div class="box">
			        	    	<% if t.last_time == 0 && t.last_timex == 0 %>
			        	    	       <%= t.first_time %>:00
				                       ~
					        	       <%= t.first_timex %>:00
				        	    	<% elsif t.last_time == 0 %>
				        	    	   <%= t.first_time %>:00
				                       ~
					        	       <%= t.first_timex %>:<%= t.last_timex %>
					        	    <% elsif t.last_timex == 0 %>
				        	    	   <%= t.first_time %>:<%= t.last_time %>
				                       ~
					        	       <%= t.first_timex %>:00
				        	    	<% else %>
					        	       <%= t.first_time %>:<%= t.last_time %>
				                       ~
					        	       <%= t.first_timex %>:<%= t.last_timex %>
					        	<% end %>
			        	    </div>
			            <% end %>
			        </td>
	            <% else %>
			        <td>
			           <%= link_to (edit_time_table_path(t)), :style => "text-decoration: none;", :class => "link" do %>
			        	  <div class="box" style="background-color:rgba(59,0,0,0.3);">
			        		  <div style="margin: 20px 0px 0px 0px;">
			        	        <%= image_tag 'stamp_yasumi.png', :width =>'20px', :height =>'20px' %>
			        	      </div>
			        	  </div>
			           <% end %>
			        </td>
		        <% end %>
		        <% end %>
		        <% end %>


				<td><div class="boxt">総労働時間<br/><%= @working_time %></div></td>
				<td><div class="boxt">残業時間</br><%= @over_time %></div></td>
			</tr>
	<% end %>
		</table>
	</div>
</div>






<!-- サイドの固定 -->
